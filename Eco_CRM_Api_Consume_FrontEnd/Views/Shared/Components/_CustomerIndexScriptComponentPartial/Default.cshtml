<script>
    let currentPage = 1;
    const pageSize = 8;
    const token = '@ViewBag.Token';

    $(document).ready(function () {
        fetchData(currentPage);
    });

    function fetchData(page) {
        $.ajax({
            url: `https://localhost:44309/api/Customers/paged-customers?pageNumber=${page}&pageSize=${pageSize}`,
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token
            },
            success: function (data) {
                currentPage = page;
                $('#currentPage').text(currentPage);
                updateTable(data);
            },
            error: function () {
                alert('Veri alınırken hata oluştu.');
            }
        });
    }

    function updateTable(data) {
        let tbody = $('#customer-table-body');
        tbody.empty();

        data.forEach(customer => {
            tbody.append(`
                                        <tr>
                                            <td>${customer.companyName || ""}</td>
                                            <td>${customer.city || ""}</td>
                                            <td>${customer.district || ""}</td>
                                            <td>${customer.address || ""}</td>
                                            <td>${customer.country || ""}</td>
                                            <td>${customer.contactName || ""}</td>
                                            <td>${customer.contactPhone1 || ""}</td>
                                            <td>${customer.contactEmail || ""}</td>
                                            <td>${customer.isDomestic ? "Evet" : "Hayır"}</td>
                                            <td>${customer.description || ""}</td>
                                            <td>${customer.status || ""}</td>
                                            <td>${customer.group || ""}</td>
                                            <td>
                                                <a href="/CustomerOperation/OperationsByCustomer/${customer.id}" class="btn btn-primary btn-sm"
                                                   style="background-color: #555; border: none; padding: 5px 10px; text-decoration: none; color: #fff; border-radius: 5px;">
                                                    Detaylar
                                                </a>
                                            </td>
                                        </tr>
                                    `);
        });
    }

    function changePage(direction) {
        if (direction === 'next') {
            fetchData(currentPage + 1);
        } else if (direction === 'prev' && currentPage > 1) {
            fetchData(currentPage - 1);
        }
    }


    document.addEventListener("DOMContentLoaded", function () {
        document.body.style.opacity = 1;
    });
</script>